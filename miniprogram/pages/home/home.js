// pages/home/home.js
let todos = []
let trash = {}
let result = []
let filter = 'none'
let scrollTop = 0
Page({

  /**
   * é¡µé¢çš„åˆå§‹æ•°æ®
   */
  data: {
    clear: '',
    indicatorColor: 'none',
    order: 'asc', //'asc'/'desc'
    isSearchBarShow: true,
    isFilterShow: false,
    isSearching: false,
    todos: [],
    isHeartBeat: false
  },
  filtLabel(evt) {
    const label = evt.detail.color
    filter = label
    this.setData({
      indicatorColor: label,
      isFilterShow: false,
    })
    if (label == 'none') {
      this._toast('å–æ¶ˆæ ‡ç­¾è¿‡æ»¤')
    }
    this._render()
  },
  toggleFilter() {
    this.setData({
      isFilterShow: !this.data.isFilterShow
    })
  },
  changeOrder() {
    let order = this.data.order
    if (order === 'asc') {
      this.setData({
        order: 'desc'
      })
    } else {
      this.setData({
        order: 'asc'
      })
    }
    wx.setStorageSync('order', this.data.order)
    this._render()
  },
  addTodo() {
    this.setData({
      isHeartBeat: true
    })
    setTimeout(() => {
      this._navToEditPage()
      this.setData({
        isHeartBeat: false
      })
    }, 500)
  },
  _navToEditPage() {
    wx.navigateTo({
      url: '../edit/edit',
    })
  },
  _render() {
    if (!todos) {
      return
    }
    let computed = []
    if (this.data.isSearching) {
      if (filter != 'none') {
        computed = result.filter(todo => todo.label == filter)
      } else {
        computed = result
      }
      if (this.data.order == 'asc') {
        computed = computed.sort((a, b) => b.timeStamp - a.timeStamp)
      } else {
        computed = computed.sort((a, b) => a.timeStamp - b.timeStamp)
      }
    } else {
      if (filter != 'none') {
        computed = todos.filter(todo => todo.label == filter)
      } else {
        computed = todos
      }
      if (this.data.order == 'asc') {
        computed = computed.sort((a, b) => b.timeStamp - a.timeStamp)
      } else {
        computed = computed.sort((a, b) => a.timeStamp - b.timeStamp)
      }
    }
    this.setData({
      todos: computed
    })
  },
  onSearch(event) {
    const keyword = event.detail.keyword.trim()
    if (!keyword) {
      this.setData({
        todos
      })
      return
    }
    filter = 'none'
    this.setData({
      isSearching: true,
      indicatorColor: 'none'
    })
    result = todos.filter(item => {
      return item.title.includes(keyword) || item.content.includes(keyword)
    })
    this._render()
    // this.setData({
    //   todos: result
    // })
  },
  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½
   */
  onLoad: function(options) {
    this._loadSettings()
    this._loadTodos()
  },
  enTag(evt) {
    let color = evt.detail.color
    let timeStamp = evt.detail.timeStamp
    for (let i in todos) {
      if (todos[i].timeStamp == timeStamp) {
        todos[i].label = color
        break
      }
    }
    this._saveTodos()
  },

  onRemove(event) {
    const timeStamp = event.detail.timeStamp
    for (let index in todos) {
      if (todos[index].timeStamp == timeStamp) {
        trash = todos[index]
        todos.splice(index, 1)
        break
      }
    }
    if (this.data.isSearching) {
      for (let index in result) {
        if (result[index].timeStamp == timeStamp) {
          result.splice(index, 1)
          console.log('result updated')
        }
      }
    }
    console.log(result)
    this._updateTrashesInStorage()
    this._render()
    this._saveTodos()

    setTimeout(() => {
      this._toast('å·²ä¸¢åˆ°åžƒåœ¾æ¡¶ðŸ’¥')
    }, 400)
  },
  _updateTrashesInStorage() {
    let trashes = wx.getStorageSync('trashes')
    if (!trashes) {
      trashes = []
    }
    trashes.unshift(trash)
    wx.setStorageSync('trashes', trashes)
  },
  _saveTodos() {
    wx.setStorageSync('todos', todos)
  },
  _loadTodos() {
    todos = wx.getStorageSync('todos')
    if (!todos) {
      wx.setStorageSync('todos', [{
        "title": "èŠæ–‹å¿—å¼‚Â·è‚å°å€©",
        "content": "      å®é‡‡è‡£ï¼Œæµ™äººï¼Œæ€§æ…·çˆ½ï¼Œå»‰éš…è‡ªé‡ã€‚æ¯å¯¹äººè¨€ï¼šâ€œç”Ÿå¹³æ— äºŒè‰²ã€‚â€é€‚èµ´é‡‘åŽï¼Œè‡³åŒ—éƒ­ï¼Œè§£è£…å…°è‹¥ã€‚å¯ºä¸­æ®¿å¡”å£®ä¸½ï¼Œç„¶è“¬è’¿æ²¡äººï¼Œä¼¼ç»è¡Œè¸ªã€‚ä¸œè¥¿åƒ§èˆï¼ŒåŒæ‰‰è™šæŽ©ï¼ŒæƒŸå—ä¸€å°èˆï¼Œæ‰ƒé”®å¦‚æ–°ã€‚åˆé¡¾æ®¿ä¸œéš…ï¼Œä¿®ç«¹æ‹±æŠŠï¼Œé˜¶ä¸‹æœ‰å·¨æ± ï¼Œé‡Žè—•å·²èŠ±ã€‚æ„ç”šä¹å…¶å¹½æ³ã€‚ä¼šå­¦ä½¿æ¡ˆä¸´ï¼ŒåŸŽèˆä»·æ˜‚ï¼Œæ€ä¾¿ç•™æ­¢ï¼Œé‚æ•£æ­¥ä»¥å¾…åƒ§å½’ã€‚æ—¥æš®æœ‰å£«äººæ¥å¯å—æ‰‰ï¼Œå®è¶‹ä¸ºç¤¼ï¼Œä¸”å‘Šä»¥æ„ã€‚å£«äººæ›°ï¼šâ€œæ­¤é—´æ— æˆ¿ä¸»ï¼Œä»†äº¦ä¾¨å±…ã€‚èƒ½ç”˜è’è½ï¼Œæ—¦æš®æƒ æ•™ï¼Œå¹¸ç”šï¼â€å®å–œï¼Œè—‰è—ä»£åºŠï¼Œæ”¯æ¿ä½œå‡ ï¼Œä¸ºä¹…å®¢è®¡ã€‚æ˜¯å¤œæœˆæ˜Žé«˜æ´ï¼Œæ¸…å…‰ä¼¼æ°´ï¼ŒäºŒäººä¿ƒè†æ®¿å»Šï¼Œå„å±•å§“å­—ã€‚å£«äººè‡ªè¨€ç‡•å§“ï¼Œå­—èµ¤éœžã€‚å®ç–‘ä¸ºèµ´è¯•è€…ï¼Œè€Œå¬å…¶éŸ³å£°ï¼Œæ®Šä¸ç±»æµ™ã€‚è¯˜ä¹‹ï¼Œè‡ªè¨€ç§¦äººï¼Œè¯­ç”šæœ´è¯šã€‚æ—¢è€Œç›¸å¯¹è¯ç«­ï¼Œé‚æ‹±åˆ«å½’å¯ã€‚\n\nã€€ã€€å®ä»¥æ–°å±…ï¼Œä¹…ä¸æˆå¯ã€‚é—»èˆåŒ—å–å–ï¼Œå¦‚æœ‰å®¶å£ã€‚èµ·ï¼Œä¼åŒ—å£çŸ³çª—ä¸‹å¾®çª¥ä¹‹ï¼Œè§çŸ­å¢™å¤–ä¸€å°é™¢è½ï¼Œæœ‰å¦‡å¯å››åä½™ï¼›åˆä¸€åªªè¡£î‰¢ç»¯ï¼Œæ’è“¬æ²“ï¼Œé²èƒŒé¾™é’Ÿï¼Œå¶è¯­æœˆä¸‹ã€‚å¦‡æ›°ï¼šâ€œå°å€©ä½•ä¹…ä¸æ¥ï¼Ÿâ€åªªæ›°ï¼šâ€œæ®†å¥½è‡³çŸ£ã€‚â€å¦‡æ›°ï¼šâ€œå°†æ— å‘å§¥å§¥æœ‰æ€¨è¨€å¦ï¼Ÿâ€æ›°ï¼šâ€œä¸é—»ï¼›ä½†æ„ä¼¼è¹™è¹™ã€‚â€å¦‡æ›°ï¼šâ€œå©¢å­ä¸å®œå¥½ç›¸è¯†ã€‚â€è¨€æœªå·²ï¼Œæœ‰åä¸ƒå…«å¥³å­æ¥ï¼Œä»¿ä½›è‰³ç»ã€‚åªªç¬‘æ›°ï¼šâ€œèƒŒåœ°ä¸è¨€äººï¼Œæˆ‘ä¸¤ä¸ªæ­£è°ˆé“ï¼Œå°å¦–å©¢æ‚„æ¥æ— è¿¹å“ï¼Œå¹¸ä¸è¨¾ç€çŸ­å¤„ã€‚â€åˆæ›°ï¼šâ€œå°å¨˜å­ç«¯å¥½æ˜¯ç”»ä¸­äººï¼Œé®èŽ«è€èº«æ˜¯ç”·å­ï¼Œä¹Ÿè¢«æ‘„åŽ»ã€‚â€å¥³æ›°ï¼šâ€œå§¥å§¥ä¸ç›¸èª‰ï¼Œæ›´é˜¿è°é“å¥½ï¼Ÿâ€å¦‡äººå¥³å­åˆä¸çŸ¥ä½•è¨€ã€‚å®æ„å…¶é‚»äººçœ·å£ï¼Œå¯ä¸å¤å¬ï¼›åˆè®¸æ—¶å§‹å¯‚æ— å£°ã€‚\n\nã€€ã€€æ–¹å°†ç¡åŽ»ï¼Œè§‰æœ‰äººè‡³å¯æ‰€ï¼Œæ€¥èµ·å®¡é¡¾ï¼Œåˆ™åŒ—é™¢å¥³å­ä¹Ÿã€‚æƒŠé—®ä¹‹ï¼Œå¥³ç¬‘æ›°ï¼šâ€œæœˆå¤œä¸å¯ï¼Œæ„¿ä¿®ç‡•å¥½ã€‚â€å®æ­£å®¹æ›°ï¼šâ€œå¿é˜²ç‰©è®®ï¼Œæˆ‘ç•äººè¨€ã€‚ç•¥ä¸€å¤±è¶³ï¼Œå»‰è€»é“ä¸§ã€‚â€å¥³äº‘ï¼šâ€œå¤œæ— çŸ¥è€…ã€‚â€å®åˆå’„ä¹‹ã€‚å¥³é€¡å·¡è‹¥å¤æœ‰è¯ã€‚å®å±ï¼šâ€œé€ŸåŽ»ï¼ä¸ç„¶ï¼Œå½“å‘¼å—èˆç”ŸçŸ¥ã€‚â€å¥³æƒ§ï¼Œä¹ƒé€€ã€‚è‡³æˆ·å¤–å¿½è¿”ï¼Œä»¥é»„é‡‘ä¸€é”­ç½®è¤¥ä¸Šã€‚å®æŽ‡æŽ·åº­å¢€ï¼Œæ›°ï¼šâ€œéžä¹‰ä¹‹ç‰©ï¼Œæ±¡æˆ‘å›Šå›Šï¼â€å¥³æƒ­å‡ºï¼Œæ‹¾é‡‘è‡ªè¨€æ›°ï¼šâ€œæ­¤æ±‰å½“æ˜¯é“çŸ³ã€‚â€\n\nã€€ã€€è¯˜æ—¦æœ‰å…°æºªç”Ÿæºä¸€ä»†æ¥å€™è¯•ï¼Œå¯“äºŽä¸œåŽ¢ï¼Œè‡³å¤œæš´äº¡ã€‚è¶³å¿ƒæœ‰å°å­”ï¼Œå¦‚é”¥åˆºè€…ï¼Œç»†ç»†æœ‰è¡€å‡ºï¼Œä¿±èŽ«çŸ¥æ•…ã€‚ç»å®¿ä¸€ä»†æ­»ï¼Œç—‡äº¦å¦‚ä¹‹ã€‚å‘æ™šç‡•ç”Ÿå½’ï¼Œå®è´¨ä¹‹ï¼Œç‡•ä»¥ä¸ºé­…ã€‚å®ç´ æŠ—ç›´ï¼Œé¢‡ä¸åœ¨æ„ã€‚å®µåˆ†å¥³å­å¤è‡³ï¼Œè°“å®æ›°ï¼šâ€œå¦¾é˜…äººå¤šçŸ£ï¼Œæœªæœ‰åˆšè‚ å¦‚å›è€…ã€‚å›è¯šåœ£è´¤ï¼Œå¦¾ä¸æ•¢æ¬ºã€‚å°å€©ï¼Œå§“è‚æ°ï¼Œåå…«å¤­æ®‚ï¼Œè‘¬äºŽå¯ºä¾§ï¼Œè¢«å¦–ç‰©å¨èƒï¼ŒåŽ†å½¹è´±åŠ¡ï¼Œè…†é¢œå‘äººï¼Œå®žéžæ‰€ä¹ã€‚ä»Šå¯ºä¸­æ— å¯æ€è€…ï¼Œæå½“ä»¥å¤œå‰æ¥ã€‚â€å®éª‡æ±‚è®¡ã€‚å¥³æ›°ï¼šâ€œä¸Žç‡•ç”ŸåŒå®¤å¯å…ã€‚â€é—®ï¼šâ€œä½•ä¸æƒ‘ç‡•ç”Ÿï¼Ÿâ€æ›°ï¼šâ€œå½¼å¥‡äººä¹Ÿï¼Œå›ºä¸æ•¢è¿‘ã€‚â€åˆé—®ï¼šâ€œè¿·äººè‹¥ä½•ï¼Ÿâ€æ›°ï¼šâ€œç‹Žæ˜µæˆ‘è€…ï¼Œéšä»¥é”¥åˆºå…¶è¶³ï¼Œå½¼å³èŒ«è‹¥è¿·ï¼Œå› æ‘„è¡€ä»¥ä¾›å¦–é¥®ã€‚åˆæƒ‘ä»¥é‡‘ï¼Œéžé‡‘ä¹Ÿï¼Œä¹ƒç½—åˆ¹é¬¼éª¨ï¼Œç•™ä¹‹èƒ½æˆªå–äººå¿ƒè‚ã€‚äºŒè€…ï¼Œå‡¡ä»¥æŠ•æ—¶å¥½è€³ã€‚â€å®æ„Ÿè°¢ï¼Œé—®æˆ’å¤‡ä¹‹æœŸï¼Œç­”ä»¥æ˜Žå®µã€‚ä¸´åˆ«æ³£æ›°ï¼šâ€œå¦¾å •çŽ„æµ·ï¼Œæ±‚å²¸ä¸å¾—ã€‚éƒŽå›ä¹‰æ°”å¹²äº‘ï¼Œå¿…èƒ½æ‹”ç”Ÿæ•‘è‹¦ã€‚å€˜è‚¯å›Šå¦¾æœ½éª¨ï¼Œå½’è‘¬å®‰å®…ï¼Œä¸å•»å†é€ ã€‚â€å®æ¯…ç„¶è¯ºä¹‹ã€‚å› é—®è‘¬å¤„ï¼Œæ›°ï¼šâ€œä½†è®°ç™½æ¨ä¹‹ä¸Šï¼Œæœ‰ä¹Œå·¢è€…æ˜¯ä¹Ÿã€‚â€è¨€å·²å‡ºé—¨ï¼Œçº·ç„¶è€Œç­ã€‚\n\nã€€ã€€æ˜Žæ—¥æç‡•ä»–å‡ºï¼Œæ—©è¯£é‚€è‡´ã€‚è¾°åŽå…·é…’é¦”ï¼Œç•™æ„å¯Ÿç‡•ã€‚æ—¢çº¦åŒå®¿ï¼Œè¾žä»¥æ€§ç™–è€½å¯‚ã€‚å®ä¸å¬ï¼Œå¼ºæºå§å…·æ¥ï¼Œç‡•ä¸å¾—å·²ï¼Œç§»æ¦»ä»Žä¹‹ï¼Œå˜±æ›°ï¼šâ€œä»†çŸ¥è¶³ä¸‹ä¸ˆå¤«ï¼Œå€¾é£Žè‰¯åˆ‡ã€‚è¦æœ‰å¾®è¡·ï¼Œéš¾ä»¥é½ç™½ã€‚å¹¸å‹¿ç¿»çª¥ç®§è¥†ï¼Œè¿ä¹‹ä¸¤ä¿±ä¸åˆ©ã€‚â€å®è°¨å—æ•™ã€‚æ—¢å„å¯ï¼Œç‡•ä»¥ç®±ç®§ç½®çª—ä¸Šï¼Œå°±æž•ç§»æ—¶ï¼Œé½å¦‚é›·å¼ã€‚å®ä¸èƒ½å¯ã€‚è¿‘ä¸€æ›´è®¸ï¼Œçª—å¤–éšéšæœ‰äººå½±ã€‚ä¿„è€Œè¿‘çª—æ¥çª¥ï¼Œç›®å…‰ç’é—ªã€‚å®æƒ§ï¼Œæ–¹æ¬²å‘¼ç‡•ï¼Œå¿½æœ‰ç‰©è£‚ç®§è€Œå‡ºï¼Œè€€è‹¥åŒ¹ç»ƒï¼Œè§¦æŠ˜çª—ä¸ŠçŸ³æ£‚ï¼Œé£™ç„¶ä¸€å°„ï¼Œå³é½æ•›å…¥ï¼Œå®›å¦‚ç”µç­ã€‚ç‡•è§‰è€Œèµ·ï¼Œå®ä¼ªç¡ä»¥è§‡ä¹‹ã€‚ç‡•æ§ç®§æ£€å¾ï¼Œå–ä¸€ç‰©ï¼Œå¯¹æœˆå—…è§†ï¼Œç™½å…‰æ™¶èŽ¹ï¼Œé•¿å¯äºŒå¯¸ï¼Œå¾„éŸ­å¶è®¸ã€‚å·²è€Œæ•°é‡åŒ…å›ºï¼Œä»ç½®ç ´ç®§ä¸­ã€‚è‡ªè¯­æ›°ï¼šâ€œä½•ç‰©è€é­…ï¼Œç›´å°”å¤§èƒ†ï¼Œè‡´åç®§å­ã€‚â€é‚å¤å§ã€‚å®å¤§å¥‡ä¹‹ï¼Œå› èµ·é—®ä¹‹ï¼Œä¸”å‘Šä»¥æ‰€è§ã€‚ç‡•æ›°ï¼šâ€œæ—¢ç›¸çŸ¥çˆ±ï¼Œä½•æ•¢æ·±éšã€‚æˆ‘å‰‘å®¢ä¹Ÿã€‚è‹¥éžçŸ³æ£‚ï¼Œå¦–å½“ç«‹æ¯™ï¼›è™½ç„¶ï¼Œäº¦ä¼¤ã€‚â€é—®ï¼šâ€œæ‰€ç¼„ä½•ç‰©ï¼Ÿâ€æ›°ï¼šâ€œå‰‘ä¹Ÿã€‚é€‚å—…ä¹‹æœ‰å¦–æ°”ã€‚â€å®æ¬²è§‚ä¹‹ã€‚æ…¨å‡ºç›¸ç¤ºï¼Œè§è§ç„¶ä¸€å°å‰‘ä¹Ÿã€‚äºŽæ˜¯ç›ŠåŽšé‡ç‡•ã€‚\n\nã€€ã€€æ˜Žæ—¥ï¼Œè§†çª—å¤–æœ‰è¡€è¿¹ã€‚é‚å‡ºå¯ºåŒ—ï¼Œè§è’åŸç´¯ç´¯ï¼Œæžœæœ‰ç™½æ¨ï¼Œä¹Œå·¢å…¶é¢ ã€‚è¿¨è¥è°‹æ—¢å°±ï¼Œè¶£è£…æ¬²å½’ã€‚ç‡•ç”Ÿè®¾ç¥–å¸ï¼Œæƒ…ä¹‰æ®·æ¸¥ï¼Œä»¥ç ´é©å›Šèµ å®ï¼Œæ›°ï¼šâ€œæ­¤å‰‘è¢‹ä¹Ÿã€‚å®è—å¯è¿œé­‘é­…ã€‚â€å®æ¬²ä»Žå—å…¶æœ¯ã€‚æ›°ï¼šâ€œå¦‚å›ä¿¡ä¹‰åˆšç›´ï¼Œå¯ä»¥ä¸ºæ­¤ï¼Œç„¶å›çŠ¹å¯Œè´µä¸­äººï¼Œéžæ­¤é“ä¸­äººä¹Ÿã€‚â€å®æ‰˜æœ‰å¦¹è‘¬æ­¤ï¼Œå‘æŽ˜å¥³éª¨ï¼Œæ•›ä»¥è¡£è¡¾ï¼ŒèµèˆŸè€Œå½’ã€‚å®æ–‹ä¸´é‡Žï¼Œå› è¥åŸè‘¬è¯¸æ–‹å¤–ï¼Œç¥­è€Œç¥æ›°ï¼šâ€œæ€œå¿å­¤é­‚ï¼Œè‘¬è¿‘èœ—å±…ï¼Œæ­Œå“­ç›¸é—»ï¼Œåº¶ä¸è§å‡ŒäºŽé›„é¬¼ã€‚ä¸€ç“¯æµ†æ°´é¥®ï¼Œæ®Šä¸æ¸…æ—¨ï¼Œå¹¸ä¸ä¸ºå«Œï¼â€ç¥æ¯•è€Œè¿”ï¼ŒåŽæœ‰äººå‘¼æ›°ï¼šâ€œç¼“å¾…åŒè¡Œï¼â€å›žé¡¾ï¼Œåˆ™å°å€©ä¹Ÿã€‚æ¬¢å–œè°¢æ›°ï¼šâ€œå›ä¿¡ä¹‰ï¼Œåæ­»ä¸è¶³ä»¥æŠ¥ã€‚è¯·ä»Žå½’ï¼Œæ‹œè¯†å§‘å«œï¼Œåªµå¾¡æ— æ‚”ã€‚â€å®¡è°›ä¹‹ï¼Œè‚Œæ˜ æµéœžï¼Œè¶³ç¿˜ç»†ç¬‹ï¼Œç™½æ˜¼ç«¯ç›¸ï¼Œå¨‡ä¸½å°¤ç»ã€‚é‚ä¸Žä¿±è‡³æ–‹ä¸­ã€‚å˜±åå°‘å¾…ï¼Œå…ˆå…¥ç™½æ¯ã€‚æ¯æ„•ç„¶ã€‚æ—¶å®å¦»ä¹…ç—…ï¼Œæ¯æˆ’å‹¿è¨€ï¼Œææ‰€éª‡æƒŠã€‚è¨€æ¬¡ï¼Œå¥³å·²ç¿©ç„¶å…¥ï¼Œæ‹œä¼åœ°ä¸‹ã€‚å®æ›°ï¼šâ€œæ­¤å°å€©ä¹Ÿã€‚â€æ¯æƒŠé¡¾ä¸é‘ã€‚å¥³è°“æ¯æ›°ï¼šâ€œå„¿é£˜ç„¶ä¸€èº«ï¼Œè¿œçˆ¶æ¯å…„å¼Ÿã€‚è’™å…¬å­éœ²è¦†ï¼Œæ³½è¢«å‘è‚¤ï¼Œæ„¿æ‰§ç®•å¸šï¼Œä»¥æŠ¥é«˜ä¹‰ã€‚â€æ¯è§å…¶ç»°çº¦å¯çˆ±ï¼Œå§‹æ•¢ä¸Žè¨€ï¼Œæ›°ï¼šâ€œå°å¨˜å­æƒ é¡¾å¾å„¿ï¼Œè€èº«å–œä¸å¯å·²ã€‚ä½†ç”Ÿå¹³æ­¢æ­¤å„¿ï¼Œç”¨æ‰¿ç¥§ç»ªï¼Œä¸æ•¢ä»¤æœ‰é¬¼å¶ã€‚â€å¥³æ›°ï¼šâ€œå„¿å®žæ— äºŒå¿ƒã€‚æ³‰ä¸‹äººæ—¢ä¸è§ä¿¡äºŽè€æ¯ï¼Œè¯·ä»¥å…„äº‹ï¼Œä¾é«˜å ‚ï¼Œå¥‰æ™¨æ˜ï¼Œå¦‚ä½•ï¼Ÿâ€æ¯æ€œå…¶è¯šï¼Œå…ä¹‹ã€‚å³æ¬²æ‹œå«‚ï¼Œæ¯è¾žä»¥ç–¾ï¼Œä¹ƒæ­¢ã€‚å¥³å³å…¥åŽ¨ä¸‹ï¼Œä»£æ¯å°¸é¥”ã€‚å…¥æˆ¿ç©¿æ¦»ï¼Œä¼¼ç†Ÿå±…è€…ã€‚\n\nã€€ã€€æ—¥æš®æ¯ç•æƒ§ä¹‹ï¼Œè¾žä½¿å½’å¯ï¼Œä¸ä¸ºè®¾åºŠè¤¥ã€‚å¥³çª¥çŸ¥æ¯æ„ï¼Œå³ç«ŸåŽ»ã€‚è¿‡æ–‹æ¬²å…¥ï¼Œå´é€€ï¼Œå¾˜å¾Šæˆ·å¤–ï¼Œä¼¼æœ‰æ‰€æƒ§ã€‚ç”Ÿå‘¼ä¹‹ã€‚å¥³æ›°ï¼šâ€œå®¤æœ‰å‰‘æ°”ç•äººã€‚å‘é“é€”ä¸­ä¸å¥‰è§è€…ï¼Œè‰¯ä»¥æ­¤æ•…ã€‚â€å®æ‚Ÿä¸ºé©å›Šï¼Œå–æ‚¬ä»–å®¤ã€‚å¥³ä¹ƒå…¥ï¼Œå°±çƒ›ä¸‹åï¼›ç§»æ—¶ï¼Œæ®Šä¸ä¸€è¯­ã€‚ä¹…ä¹‹ï¼Œé—®ï¼šâ€œå¤œè¯»å¦ï¼Ÿå¦¾å°‘è¯µã€Šæ¥žä¸¥ç»ã€‹ï¼Œä»Šå¼ºåŠé—å¿˜ã€‚æµ¼æ±‚ä¸€å·ï¼Œå¤œæš‡å°±å…„æ­£ä¹‹ã€‚â€å®è¯ºã€‚åˆåï¼Œé»˜ç„¶ï¼ŒäºŒæ›´å‘å°½ï¼Œä¸è¨€åŽ»ã€‚å®ä¿ƒä¹‹ã€‚æ„€ç„¶æ›°ï¼šâ€œå¼‚åŸŸå­¤é­‚ï¼Œæ®Šæ€¯è’å¢“ã€‚â€å®æ›°ï¼šâ€œæ–‹ä¸­åˆ«æ— åºŠå¯ï¼Œä¸”å…„å¦¹äº¦å®œè¿œå«Œã€‚â€å¥³èµ·ï¼Œé¢¦è¹™æ¬²å•¼ï¼Œè¶³î€’å„´è€Œæ‡’æ­¥ï¼Œä»Žå®¹å‡ºé—¨ï¼Œæ¶‰é˜¶è€Œæ²¡ã€‚å®çªƒæ€œä¹‹ï¼Œæ¬²ç•™å®¿åˆ«æ¦»ï¼Œåˆæƒ§æ¯å—”ã€‚å¥³æœæ—¦æœæ¯ï¼Œæ§åŒœæ²ƒç›¥ï¼Œä¸‹å ‚æ“ä½œï¼Œæ— ä¸æ›²æ‰¿æ¯å¿—ã€‚é»„æ˜å‘Šé€€ï¼Œè¾„è¿‡æ–‹å¤´ï¼Œå°±çƒ›è¯µç»ã€‚è§‰å®å°†å¯ï¼Œå§‹æƒ¨ç„¶å‡ºã€‚\n\nã€€ã€€å…ˆæ˜¯ï¼Œå®å¦»ç—…åºŸï¼Œæ¯åŠ¬ä¸å ªï¼›è‡ªå¾—å¥³ï¼Œé€¸ç”šï¼Œå¿ƒå¾·ä¹‹ã€‚æ—¥æ¸ç¨”ï¼Œäº²çˆ±å¦‚å·±å‡ºï¼Œç«Ÿå¿˜å…¶ä¸ºé¬¼ï¼Œä¸å¿æ™šä»¤åŽ»ï¼Œç•™ä¸ŽåŒå§èµ·ã€‚å¥³åˆæ¥æœªå°é¥®é£Ÿï¼ŒåŠå¹´æ¸å•œç¨€é…¡ã€‚æ¯å­çš†æººçˆ±ä¹‹ï¼Œè®³è¨€å…¶é¬¼ï¼Œäººäº¦ä¸çŸ¥è¾¨ä¹Ÿã€‚æ— ä½•ï¼Œå®å¦»äº¡ï¼Œæ¯éšæœ‰çº³å¥³æ„ï¼Œç„¶æäºŽå­ä¸åˆ©ã€‚å¥³å¾®çŸ¥ä¹‹ï¼Œä¹˜é—´å‘Šæ›°ï¼šâ€œå±…å¹´ä½™ï¼Œå½“çŸ¥è‚è†ˆã€‚ä¸ºä¸æ¬²ç¥¸è¡Œäººï¼Œæ•…ä»ŽéƒŽå›æ¥ã€‚åŒºåŒºæ— ä»–æ„ï¼Œæ­¢ä»¥å…¬å­å…‰æ˜Žç£Šè½ï¼Œä¸ºå¤©äººæ‰€é’¦çž©ï¼Œå®žæ¬²ä¾èµžä¸‰æ•°å¹´ï¼Œå€Ÿåšå°è¯°ï¼Œä»¥å…‰æ³‰å£¤ã€‚â€æ¯äº¦çŸ¥æ— æ¶æ„ï¼Œä½†æƒ§ä¸èƒ½å»¶å®—å—£ã€‚å¥³æ›°ï¼šâ€œå­å¥³æƒŸå¤©æ‰€æŽˆã€‚éƒŽå›æ³¨ç¦ç±ï¼Œæœ‰äº¢å®—å­ä¸‰ï¼Œä¸ä»¥é¬¼å¦»è€Œé‚å¤ºä¹Ÿã€‚â€æ¯ä¿¡ä¹‹ï¼Œä¸Žå­è®®ã€‚å®å–œï¼Œå› åˆ—ç­µå‘Šæˆšå…šã€‚æˆ–è¯·è§Œæ–°å¦‡ï¼Œå¥³æ…¨ç„¶åŽå¦†å‡ºï¼Œä¸€å ‚å°½çœ™ï¼Œåä¸ç–‘å…¶é¬¼ï¼Œç–‘ä¸ºä»™ã€‚ç”±æ˜¯äº”å…šè¯¸å†…çœ·ï¼Œå’¸æ‰§è´½ä»¥è´ºï¼Œäº‰æ‹œè¯†ä¹‹ã€‚å¥³å–„ç”»å…°ã€æ¢…ï¼Œè¾„ä»¥å°ºå¹…é…¬ç­”ï¼Œå¾—è€…è—ä¹‹ä»€è¢­ä»¥ä¸ºè£ã€‚ä¸€æ—¥ä¿¯é¢ˆçª—å‰ï¼Œæ€Šæ€…è‹¥å¤±ã€‚å¿½é—®ï¼šâ€œé©å›Šä½•åœ¨ï¼Ÿâ€æ›°ï¼šâ€œä»¥å¿ç•ä¹‹ï¼Œæ•…ç¼„è‡´ä»–æ‰€ã€‚â€æ›°ï¼šâ€œå¦¾å—ç”Ÿæ°”å·²ä¹…ï¼Œå½“ä¸å¤ç•ï¼Œå®œå–æŒ‚åºŠå¤´ã€‚â€å®è¯˜å…¶æ„ï¼Œæ›°ï¼šâ€œä¸‰æ—¥æ¥ï¼Œå¿ƒæ€”å¿¡æ— åœæ¯ï¼Œæ„é‡‘åŽå¦–ç‰©ï¼Œæ¨å¦¾è¿œéï¼Œææ—¦æ™šå¯»åŠä¹Ÿã€‚â€å®æžœæºé©å›Šæ¥ã€‚å¥³åå¤å®¡è§†ï¼Œæ›°ï¼šâ€œæ­¤å‰‘ä»™å°†ç››äººå¤´è€…ä¹Ÿã€‚æ•è´¥è‡³æ­¤ï¼Œä¸çŸ¥æ€äººå‡ ä½•è®¸ï¼å¦¾ä»Šæ—¥è§†ä¹‹ï¼Œè‚ŒçŠ¹ç²Ÿæ —ã€‚â€ä¹ƒæ‚¬ä¹‹ã€‚æ¬¡æ—¥åˆå‘½ç§»æ‚¬æˆ·ä¸Šã€‚å¤œå¯¹çƒ›åï¼Œæ¬»æœ‰ä¸€ç‰©ï¼Œå¦‚é£žé¸Ÿè‡³ã€‚å¥³æƒŠåŒ¿å¤¹å¹•é—´ã€‚å®è§†ä¹‹ï¼Œç‰©å¦‚å¤œå‰çŠ¶ï¼Œç”µç›®è¡€èˆŒï¼Œç’é—ªæ”«æ‹¿è€Œå‰ï¼Œè‡³é—¨å´æ­¥ï¼Œé€¡å·¡ä¹…ä¹‹ï¼Œæ¸è¿‘é©å›Šï¼Œä»¥çˆªæ‘˜å–ï¼Œä¼¼å°†æŠ“è£‚ã€‚å›Šå¿½æ ¼ç„¶ä¸€å“ï¼Œå¤§å¯åˆç¯‘ï¼Œææƒšæœ‰é¬¼ç‰©çªå‡ºåŠèº«ï¼Œæªå¤œå‰å…¥ï¼Œå£°é‚å¯‚ç„¶ï¼Œå›Šäº¦é¡¿ç´¢å¦‚æ•…ã€‚å®éª‡è¯§ï¼Œå¥³äº¦å‡ºï¼Œå¤§å–œæ›°ï¼šâ€œæ— æ™çŸ£ï¼â€å…±è§†å›Šä¸­ï¼Œæ¸…æ°´æ•°æ–—è€Œå·²ã€‚\n\nã€€ã€€åŽæ•°å¹´ï¼Œå®æžœç™»è¿›å£«ã€‚ä¸¾ä¸€ç”·ã€‚çº³å¦¾åŽï¼Œåˆå„ç”Ÿä¸€ç”·ï¼Œçš†ä»•è¿›æœ‰å£°ã€‚",
        "timeStamp": Date.now().toString(),
        label: 'white'
      }])
      todos = wx.getStorageSync('todos')
    }
    this._render()
    this.setData({
      isSearching: false
    })
  },
  _loadSettings() {
    let order = wx.getStorageSync('order')
    if (!order) {
      order = 'asc'
    }
    this.setData({
      order
    })
    wx.setStorageSync('order', order)
  },
  _toast(text) {
    wx.showToast({
      title: text,
      icon: 'none',
      duration: 1500
    })
  },
  cancelSearch() {
    this.setData({
      isSearching: false,
      clear: Date.now()
    })
    this._loadTodos()
  },

  onPageScroll(event) {
    if (event.scrollTop > scrollTop) {
      scrollTop = event.scrollTop
      if (this.data.isSearchBarShow) {
        this.setData({
          isSearchBarShow: false
        })
      }
    } else {
      scrollTop = event.scrollTop
      if (!this.data.isSearchBarShow) {
        this.setData({
          isSearchBarShow: true
        })
      }
    }
  },
  onShow() {
    this.setData({
      clear: Date.now().toString()
    })
    let isReloadRequired = wx.getStorageSync('isReloadRequired')
    if (isReloadRequired) {
      wx.setStorageSync('isReloadRequired', false)
      this.onLoad()
    }
  }
})